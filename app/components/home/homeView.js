var $         = require('jquery');
var Backbone  = require('backbone');
var template  = require("./home.jade");
var UserModel = require('../../shared/collections/user').model;


module.exports = Backbone.View.extend({
    className : 'welcomePanel',

    events: {
        'click button': 'nameConfirm'
    },

    initialize: function () {
        this.render();
    },

    render: function () {
        var self = this;
        self.collection.fetch().then(function (userData) {
            console.dir(userData);
            if(userData.length){
                // 只有一个用户时，跳转到该用户的Dashboard
                if(userData.length === 1){
                    var userRoute = userData[0].userName;
                    Backbone.history.navigate(userRoute, { trigger: true });
                }
                // 多于一个用户名时，让用户选择
                if(userData.length > 1){
                    self.$el.html(template({ userData: userData }));
                }
            }else{
                // 未创建任何用户
                self.$el.html(template());
            }
        });

        return self;
    },

    nameConfirm: function (e) {
        var userData  = {};
        var userName  = this.$el.find('input').val();
        var userRoute = '';

        userData.userName = userName;
        userRoute += userName;

        this.collection.create(userData);

        Backbone.history.navigate(userRoute, { trigger: true });
    }
});
